{"version":3,"file":"route.js","sourceRoot":"","sources":["../src/lib/route.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EACL,aAAa,EACb,IAAI,EACJ,gBAAgB,EAChB,UAAU,EACV,QAAQ,GAET,MAAM,aAAa,CAAC;AACrB,OAAO,EAAE,UAAU,EAAE,MAAM,iCAAiC,CAAC;AAC7D,OAAO,EAAE,OAAO,EAAE,aAAa,EAAE,MAAM,aAAa,CAAC;AAIrD,OAAO,EAAE,QAAQ,EAAE,cAAc,EAAE,MAAM,WAAW,CAAC;AAErD,OAAO,EAAE,cAAc,EAAE,aAAa,EAAS,MAAM,aAAa,CAAC;AAEnE,IAAI,eAAe,GAAG,KAAK,CAAC;AAE5B,yFAAyF;AACzF,MAAM,CAAC,IAAI,UAAe,CAAC;AAE3B,eAAe,CAAC,KAAkC,EAAQ,EAAE;IAC1D;;;;;OAKG;IAEH,IAAM,KAAK,GAAX,MAAM,KAAM,SAAQ,OAAO,CAAC,KAA0B,CAAC,CAAC,UAAU,CAAC;QAAnE;;YAES,WAAM,GAAY,KAAK,CAAC;YAMrB,WAAM,GAAgB,EAAE,CAAC;YAMzB,gBAAW,GAAY,KAAK,CAAC;YAYhC,kBAAa,GAAY,KAAK,CAAC;QAiGxC,CAAC;QA/FQ,YAAY;YACjB,IAAI,CAAC,eAAe,EAAE;gBACpB,aAAa,CAAC,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAA0B,EAAQ,EAAE;oBACzE,MAAM,IAAI,GAAG,MAAM,CAAC,kBAAkB,CAAC,QAAQ,GAAG,MAAM,GAAG,IAAI,CAAC,CAAC;oBACjE,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC;gBACvC,CAAC,CAAC,CAAC;gBACH,eAAe,GAAG,IAAI,CAAC;aACxB;YAED,IAAI,OAAO,GAA+B,IAAI,CAAC,aAAa,CAAC;YAC7D,IAAI,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;YAEpB,OAAO,OAAO,EAAE;gBACd,MAAM,eAAe,GAAG,OAAO,CAAC,OAAO,CAAC,WAAW,CAAU,CAAC;gBAE9D,IAAI,eAAe,EAAE;oBACnB,IAAI,GAAG,GAAG,eAAe,CAAC,IAAI,GAAG,IAAI,EAAE,CAAC;iBACzC;gBAED,OAAO,GAAG,eAAe,IAAI,eAAe,CAAC,aAAa,CAAC;aAC5D;YAED,MAAM,cAAc,GAAG,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC,CAAC;YAEhE,IAAI,cAAc,EAAE;gBAClB,IAAI,IAAI,IAAI,CAAC;aACd;YAED,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YAEjB,IAAI,OAAO,IAAI,CAAC,IAAI,KAAK,WAAW,EAAE;gBACpC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;aACrC;QACH,CAAC;QAEM,YAAY,CAAC,KAA0B;YAC5C,MAAM,QAAQ,GAAG,aAAa,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;YACjD,MAAM,eAAe,GAAG,CAAC,IAAI,CAAC,MAAM,IAAI,QAAQ,CAAC;YACjD,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;YACvB,IAAI,CAAC,MAAM,GAAG,cAAc,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;YAE/C,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,OAAO,EAAE;gBAC/B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBACxB,IAAI,CAAC,OAAO,EAAE;qBACX,IAAI,CAAC,GAAS,EAAE;oBACf,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;gBAC3B,CAAC,CAAC;qBACD,KAAK,CAAC,GAAS,EAAE;oBAChB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;gBAC3B,CAAC,CAAC,CAAC;aACN;YACD,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;gBACtC,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,WAAW,EAAE;oBACzC,IAAI,eAAe,EAAE;wBACnB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;qBACrC;iBACF;qBAAM;oBACL,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;iBACvB;aACF;QACH,CAAC;QAEO,WAAW,CACjB,SAAiB,EACjB,gBAA0C;YAE1C,MAAM,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;YACvD,IAAI,UAAU,GAAG,EAAE,CAAC;YAEpB,IAAI,gBAAgB,EAAE;gBACpB,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC;qBACvC,GAAG,CAAC,CAAC,KAAa,EAAU,EAAE,CAAC,IAAI,KAAK,KAAK,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC;qBACnE,IAAI,CAAC,EAAE,CAAC,CAAC;aACb;YAED,MAAM,QAAQ,GAAG,IAAI,OAAO,GAAG,UAAU,MAAM,OAAO,GAAG,CAAC;YAE1D,OAAO,IAAI,CAAA,GAAG,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC;QACvC,CAAC;QAEM,MAAM;YACX,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBAChB,OAAO,IAAI,CAAA,EAAE,CAAC;aACf;YAED,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,WAAW,EAAE;gBACpC,OAAO,OAAO,IAAI,CAAC,OAAO,KAAK,WAAW,CAAC,CAAC,CAAC,IAAI,CAAA,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aACtF;YAED,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,WAAW,EAAE;gBACzC,OAAO,IAAI,CAAA,eAAe,CAAC;aAC5B;YAED,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QACvD,CAAC;KACF,CAAA;IAzHC;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;yCACZ;IAG/B;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;4CACD;IAG1B;QADC,gBAAgB,EAAE;yCACgB;IAGnC;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;uCACN;IAGrB;QADC,gBAAgB,EAAE;8CACoB;IAGvC;QADC,QAAQ,EAAE;0CAC0B;IAGrC;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;0CACH;IAGxB;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;4CACwB;IAGnD;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;gDACU;IA1BlC,KAAK;QADV,aAAa,CAAC,WAAW,CAAC;OACrB,KAAK,CA2HV;IAED,UAAU,GAAG,KAAK,CAAC;AACrB,CAAC,CAAC","sourcesContent":["import {\n  customElement,\n  html,\n  internalProperty,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { unsafeHTML } from 'lit-html/directives/unsafe-html';\nimport { connect, installRouter } from 'pwa-helpers';\nimport { LazyStore } from 'pwa-helpers/lazy-reducer-enhancer';\nimport { Store } from 'redux';\nimport type { ReadonlyDeep } from 'type-fest';\nimport { addRoute, setActiveRoute } from './actions';\nimport { RouteParams } from './reducer';\nimport { getRouteParams, isRouteActive, State } from './selectors';\n\nlet routerInstalled = false;\n\n// eslint-disable-next-line import/no-mutable-exports, @typescript-eslint/no-explicit-any\nexport let RouteClass: any;\n\nexport default (store: Readonly<Store & LazyStore>): void => {\n  /**\n   * Element that renders its content or a component\n   * when browser route matches\n   * @element lit-route\n   * @demo ../demo/index.html\n   */\n  @customElement('lit-route')\n  class Route extends connect(store as Store & LazyStore)(LitElement) {\n    @property({ type: Boolean, reflect: true })\n    public active: boolean = false;\n\n    @property({ type: String })\n    public component?: string;\n\n    @internalProperty()\n    protected params: RouteParams = {};\n\n    @property({ type: String })\n    public path?: string;\n\n    @internalProperty()\n    protected isResolving: boolean = false;\n\n    @property()\n    public resolve?: () => Promise<void>;\n\n    @property({ type: String })\n    public loading?: string;\n\n    @property({ type: Object })\n    public scrollOpt?: boolean | ScrollIntoViewOptions;\n\n    @property({ type: Boolean })\n    public scrollDisable: boolean = false;\n\n    public firstUpdated(): void {\n      if (!routerInstalled) {\n        installRouter(({ pathname, search, hash }: ReadonlyDeep<Location>): void => {\n          const path = window.decodeURIComponent(pathname + search + hash);\n          store.dispatch(setActiveRoute(path));\n        });\n        routerInstalled = true;\n      }\n\n      let current: Route | HTMLElement | null = this.parentElement;\n      let { path } = this;\n\n      while (current) {\n        const closestLitRoute = current.closest('lit-route') as Route;\n\n        if (closestLitRoute) {\n          path = `${closestLitRoute.path}${path}`;\n        }\n\n        current = closestLitRoute && closestLitRoute.parentElement;\n      }\n\n      const hasChildRoutes = Boolean(this.querySelector('lit-route'));\n\n      if (hasChildRoutes) {\n        path += '.*';\n      }\n\n      this.path = path;\n\n      if (typeof this.path !== 'undefined') {\n        store.dispatch(addRoute(this.path));\n      }\n    }\n\n    public stateChanged(state: ReadonlyDeep<State>): void {\n      const isActive = isRouteActive(state, this.path);\n      const hasBecomeActive = !this.active && isActive;\n      this.active = isActive;\n      this.params = getRouteParams(state, this.path);\n\n      if (this.active && this.resolve) {\n        this.isResolving = true;\n        this.resolve()\n          .then((): void => {\n            this.isResolving = false;\n          })\n          .catch((): void => {\n            this.isResolving = false;\n          });\n      }\n      if (this.active && !this.scrollDisable) {\n        if (typeof this.scrollOpt !== 'undefined') {\n          if (hasBecomeActive) {\n            this.scrollIntoView(this.scrollOpt);\n          }\n        } else {\n          window.scrollTo(0, 0);\n        }\n      }\n    }\n\n    private getTemplate(\n      component: string,\n      attributesObject?: Record<string, unknown>,\n    ): TemplateResult {\n      const tagName = component.replace(/[^A-Za-z0-9-]/, '');\n      let attributes = '';\n\n      if (attributesObject) {\n        attributes = Object.keys(attributesObject)\n          .map((param: string): string => ` ${param}=\"${this.params[param]}\"`)\n          .join('');\n      }\n\n      const template = `<${tagName}${attributes}></${tagName}>`;\n\n      return html`${unsafeHTML(template)}`;\n    }\n\n    public render(): TemplateResult {\n      if (!this.active) {\n        return html``;\n      }\n\n      if (this.resolve && this.isResolving) {\n        return typeof this.loading === 'undefined' ? html`` : this.getTemplate(this.loading);\n      }\n\n      if (typeof this.component === 'undefined') {\n        return html`<slot></slot>`;\n      }\n\n      return this.getTemplate(this.component, this.params);\n    }\n  }\n\n  RouteClass = Route;\n};\n\ndeclare global {\n  interface Window {\n    decodeURIComponent: (encodedURIComponent: string) => string;\n  }\n}\n"]}